extends layout

block content
  h2 Lista de Clientes

  if clientes && clientes.length
    table
      thead
        tr
          th ID
          th Nombre
          th Email
          th Teléfono
          th Acciones
      tbody
        each c in clientes
          tr
            td #{c.id}
            td #{c.nombre}
            td #{c.email}
            td #{c.telefono}
            td
              a.button(href=`/clientes/${c.id}/eventos`) Sus eventos
              button.delete-cliente(data-id=c.id) 🗑️
  else
    p No hay clientes cargados.

  h3 Agregar nuevo cliente
  form(action="/clientes" method="post")
    div
      input(type="text" name="nombre" placeholder="Nombre" required)
    div
      input(type="email" name="email" placeholder="Email" required)
    div
      input(type="text" name="telefono" placeholder="Teléfono")
    div
      button(type="submit") Agregar

  script.
    document.addEventListener('click', async (ev) => {
      if (ev.target.matches('.delete-cliente')) {
        const id = ev.target.dataset.id;
        if (!confirm('¿Eliminar cliente #' + id + '?')) return;
        const res = await fetch('/clientes/api/' + id, { method: 'DELETE' });
        if (res.ok) location.reload(); else alert('No se pudo eliminar (quizá tiene eventos)');
      }
    });


