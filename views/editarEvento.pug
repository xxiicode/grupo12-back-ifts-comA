extends layout

block content
  .container.mt-4
    .card.shadow-lg
      .card-body
        h2.text-primary.mb-4 Editar evento

        form(action=`/eventos/editar/${evento._id}` method="post")
          .row.g-3
            .col-md-6
              label.form-label(for="nombre") Nombre
              input.form-control#nombre(type="text" name="nombre" value=evento.nombre required)

            .col-md-6
              label.form-label(for="fecha") Fecha
              input.form-control#fecha(type="date" name="fecha" value=evento.fechaFormateada required)

            .col-md-6
              label.form-label(for="lugar") Lugar
              input.form-control#lugar(type="text" name="lugar" value=evento.lugar)

            .col-md-6
              label.form-label(for="presupuesto") Presupuesto
              input.form-control#presupuesto(type="number" name="presupuesto" value=evento.presupuesto)

            .col-md-6
              label.form-label(for="estado") Estado
              select.form-select#estado(name="estado")
                option(value="Planificado" selected=(evento.estado === "Planificado")) Planificado
                option(value="En curso" selected=(evento.estado === "En curso")) En curso
                option(value="Finalizado" selected=(evento.estado === "Finalizado")) Finalizado

            // ========================================
            // CLIENTE 
            // ========================================
            .col-md-6
              label.form-label(for="clienteId") Cliente
              select.form-select#clienteId(name="clienteId" required)
                option(value="") -- Seleccionar cliente --
                each c in clientes
                  option(
                    value=c._id
                    selected=(c._id.toString() === evento.clienteId._id.toString())
                  ) #{c.nombre || c.username}

            // ========================================
            // COORDINADOR 
            // ========================================
            .col-md-6
              label.form-label(for="coordinadorId") Coordinador
              select.form-select#coordinadorId(name="coordinadorId" required)
                option(value="") -- Seleccionar coordinador --
                each coord in coordinadores
                  option(
                    value=coord._id
                    selected=(coord._id.toString() === evento.coordinadorId._id.toString())
                  ) #{coord.nombre || coord.username}

            // ========================================
            // ASISTENTES -  SELECCIÃ“N MULTIPLE
            // ========================================
            .col-md-12
              label.form-label(for="asistentesIds") Asistentes (Ctrl/Cmd + click para seleccionar varios, max 10)
              select.form-select(name="asistentesIds" multiple required size=8)
                each a in asistentes
                  -
                    const seleccionados = evento.asistentesIds
                      ? evento.asistentesIds.map(x => x._id.toString())
                      : [];
                    const isSelected = seleccionados.includes(a._id.toString());
                  option(value=a._id selected=isSelected) #{a.nombre || a.username}

          .mt-4.d-flex.justify-content-end.gap-2
            a.btn.btn-outline-secondary(href="/eventos") Cancelar
            button.btn.btn-success(type="submit") Guardar cambios
